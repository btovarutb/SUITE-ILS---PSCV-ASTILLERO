<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotecmar || Equipo - RCM</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/mostrar_RCM.css') }}">
  </head>
  <body>
    <main>
      <div style="display: flex; align-items: center; justify-content: center; gap: 12px;">
        <h2 class="section-title text-center"> Formato de Cuadro de Decisiones (RCM)</h2>
        <button data-url="{{ url_for('editar_RCM_lista', id_equipo_info=id_equipo_info) }} "
            data-section="section12" 
            class="btn btn-primary no-print" 
            style="padding: 8px 15px; border-radius: 10px;">
          <i class="bi bi-pen" style="color: whitesmoke; font-size: 14px;"></i>
        </button>
      </div>
        <button class="scroll-button left hidden scroll-left">◀</button>
        <div class="scroll-container-horizontal">
          <table class="table table-bordered">
            <thead>
              <tr>
                <th scope="col" >#</th>
                <!--
                <th scope="col" >Sistema</th>
                <th scope="col" >Falla Funcional</th>
                <th scope="col" >Item o componente</th>
                <th scope="col" >Código Modo de Falla</th>
                <th scope="col" >Consecutivo de Modo de Falla</th>
                <th scope="col" >Descripción Modo de Falla</th>
                <th scope="col" >Causas</th>
                -->
                <th>No. Función (F)</th>
                <th>Falla funcional (FF)</th>
                <th>No. Modo de falla (MF)</th>
                <th>No. Efecto de falla (EF)</th>
                <th scope="col" >Hidden failures</th>
                <th scope="col" >Safety</th>
                <th scope="col" >Environment</th>
                <th scope="col" >Operation</th>
                <th scope="col" >H1/S1/N1/O1</th>
                <th scope="col" >H2/S2/N2/O2</th>
                <th scope="col" >H3/S3/N3/O3</th>
                <th scope="col" >H4/S4/</th>
                <th scope="col" >H5</th>
                <th scope="col" >Patrón de falla</th>
                <th scope="col" >Tarea propuesta</th>
                <th scope="col" >Frecuencia</th>
                <th scope="col" >A Realizar por LORA</th>
                <th scope="col" >Severidad</th>
                <th scope="col" >Ocurrencia</th>
                <th scope="col" >Detección</th>
                <th scope="col" >NPRR</th>
                <th scope="col" >Riesgo</th>
                <th scope="col" >Tarea contemplada en plan de mantenimiento actual</th>
                <th scope="col" >Fuente</th>

              </tr>
            </thead>
            <tbody>
              {% for rcm in rcms %}
              <tr>
                <td>{{ loop.index }}</td>
                <!--
                <td>{{ rcm['sistema'] }}</td>
                <td>{{ rcm['falla_funcional'] }}</td>
                <td>{{ rcm['componente'] }}</td>
                <td>{{ rcm['codigo_modo_falla'] }}</td>
                <td>{{ rcm['consecutivo_modo_falla'] }}</td>
                <td>{{ rcm['descripcion_modo_falla'] }}</td>
                <td>{{ rcm['causa'] }}</td>
                -->
                <td>{{ rcm['no_funcion'] }}</td>
                <td>{{ rcm['falla_funcional'] }}</td>
                <td>{{ rcm['no_modo_falla'] }}</td>
                <td>{{ rcm['no_efecto_falla'] }}</td>
                <td>{{ rcm['hidden_failures'] }}</td>
                <td>{{ rcm['safety'] }}</td>
                <td>{{ rcm['environment'] }}</td>
                <td>{{ rcm['operation'] }}</td>
                <td>{{ rcm['h1_s1_n1_o1'] }}</td>
                <td>{{ rcm['h2_s2_n2_o2'] }}</td>
                <td>{{ rcm['h3_s3_n3_o3'] }}</td>
                <td>{{ rcm['h4_s4'] }}</td>
                <td>{{ rcm['h5'] }}</td>
                <td>
                  {% if rcm['patron_de_falla'] %}
                      <a href="#" class="open-modal" data-bs-toggle="modal" data-bs-target="#modalImagen" style="color: #003366"
                         data-img="{{ rcm['patron_de_falla'] }}">
                          Abrir Imagen
                      </a>
                  {% else %}
                      No disponible
                  {% endif %}
                </td>
                <td>{{ rcm['tarea'] }}</td>
                <td>{{ rcm['intervalo_inicial_horas'] }}</td>
                <td>{{ rcm['actividades'] }}</td>
                <td>{{ rcm['calculo_severidad'] }}</td>
                <td>{{ rcm['ocurrencia_valor'] }}</td>
                <td>{{ rcm['probabilidad_deteccion'] }}</td>
                <td>{{ rcm['rpn'] }}</td>
                <td>{{ rcm['riesgo'] }}</td>
                <td>{{ rcm['tarea_contemplada'] }}</td>
                <td>{{ rcm['fuente'] }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <button class="scroll-button right scroll-right">▶</button>
    </main>
  </body>

  <!-- Modal para mostrar la imagen -->
  <div class="modal fade" id="modalImagen" tabindex="-1" aria-labelledby="modalImagenLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalImagenLabel">Patrón de Falla</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <img id="imagenModal" src="" class="img-fluid" alt="Imagen no disponible">
            </div>
        </div>
    </div>
  </div>

</html>        

<script>
  document.addEventListener('DOMContentLoaded', function() {
      // Seleccionar todos los enlaces con la clase "open-modal"
      document.querySelectorAll('.open-modal').forEach(link => {
          link.addEventListener('click', function() {
              // Obtener el valor de la imagen Base64
              const imagenBase64 = this.getAttribute('data-img');
              
              // Verificar si hay un valor válido y actualizar el src del modal
              if (imagenBase64) {
                  document.getElementById('imagenModal').setAttribute('src', imagenBase64);
              } else {
                  document.getElementById('imagenModal').setAttribute('src', '');
              }
          });
      });
  });
</script>

