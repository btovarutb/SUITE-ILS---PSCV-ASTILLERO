<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotecmar || Equipo - Herramientas Especiales</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/FMEA.css') }}">
</head>
<body>
  <main>
    <div style="display: flex; align-items: center; justify-content: center; gap: 12px;">
      <h2 class="section-title text-center">Módulo de Herramientas</h2>
      <button data-url="{{ url_for('mostrar_herramientas_especiales_ext', id_equipo_info=id_equipo_info)}} "
          data-section="section12" 
          class="btn btn-primary no-print" 
          style="padding: 8px 15px; border-radius: 10px;">
        <i class="bi bi-pen" style="color: whitesmoke; font-size: 14px;"></i>
      </button>
    </div>
    
    

    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true">Herramientas Generales</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="false">Herramientas Especiales</button>
      </li>
    </ul>

    <div class="tab-content" id="myTabContent">
      <!-- Pestaña de "Análisis de herramientas" -->
      <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
        <table class="table">
          <thead>
            <tr>
              <th scope="col">Nombre de la herramienta</th>
              <th scope="col">Parte número</th>
              <th scope="col">Dibujo de sección transversal</th>
              <th scope="col">Cantidad</th>


              <th scope="col">Costo</th>
            </tr>
          </thead>
          <tbody>
            {% for analisis in analisis %}
            <tr>
              <td>{{ analisis.nombre }}</td>
              <td>{{ analisis.parte_numero }}</td>
              <td>
                {% if analisis.dibujo_seccion_transversal %}
                {% set img64 = analisis.dibujo_seccion_transversal|b64encode %}
                {% set mime = img64[:5] %}
                {% if mime in ['iVBOR', '/9j/4'] %}
                  <button type="button" class="btn btn-link open-modal" data-img="data:image/png;base64,{{ img64 }}">
                    Ver imagen
                  </button>
                {% else %}
                  <span class="text-muted">Imagen no disponible</span>
                {% endif %}
              {% else %}
                <span class="text-muted">Sin imagen</span>
              {% endif %}              
              </td>
              <td>{{ analisis.cantidad }}</td>

              <td>{{ "{:,.2f}".format(analisis.valor).replace(',', 'X').replace('.', ',').replace('X', '.') }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Pestaña de "Herramientas especiales" -->
      <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
        <table class="table">
          <thead>
            <tr>
              <th scope="col">Nombre de la herramienta</th>
              <th scope="col">Parte número</th>
              <th scope="col">Dibujo de sección transversal</th>
              <th scope="col">Cantidad</th>
              <th scope="col">Costo</th>
              <th scope="col">Manual referenciado</th>
            </tr>
          </thead>
          <tbody>
            {% for herramienta in herramientas %}
            <tr>
              <td>{{ herramienta.nombre_herramienta }}</td>
              <td>{{ herramienta.parte_numero }}</td>
              <td>
                {% if herramienta.dibujo_seccion_transversal %}
                  {% set img64 = herramienta.dibujo_seccion_transversal|b64encode %}
                  {% set mime = img64[:5] %}
                  {% if mime in ['iVBOR', '/9j/4'] %}
                    <button type="button" class="btn btn-link open-modal" data-img="data:image/png;base64,{{ img64 }}">
                      Ver imagen
                    </button>
                  {% else %}
                    <span class="text-muted">Imagen no disponible</span>
                  {% endif %}
                {% else %}
                  <span class="text-muted">Sin imagen</span>
                {% endif %}
              </td>
              <td>{{ herramienta.cantidad }}</td>
              <td>{{ herramienta.valor }}</td>
              <td>{{ herramienta.manual_referencia }}</td>
            {% endfor %}
          </tbody>
      </table>
    </div>
    <!-- Modal de Imagen -->
    <div class="modal fade" id="modalImagen" tabindex="-1" aria-labelledby="modalImagenLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body text-center">
            <img id="imagenModal" class="img-fluid rounded" style="max-width: 90%; max-height: 80vh;" alt="Imagen no disponible">
          </div>
        </div>
      </div>
    </div>
    <script src="{{ url_for('static', filename='js/mostrar_herramientas.js') }}"></script>
  </main>
</body>  
