{% extends './base.html' %}

{% block title %}Cotecmar || Equipo - RCM{% endblock %}

{% block custom %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/FMEA.css') }}">
{% endblock %}



{% block nombre %}LSA | RCM{% endblock %}

{% block body %}

    <div class="container" id="reporte">
        <div class="row toolBar" style="position: sticky; top:65px">
            <div class="col-8 m-0 pt-3" style="align-content: center;">
                <h3 class="titulo">Reliability Centered Maintenance (RCM)</h3>
                <h5 style="color: #013882; padding-left: 10px; "> Para {{ nombre_equipo }} </h5>
            </div>
            <div class="col-4 pt-3" style="align-items: start; justify-content: end; display: flex; padding-right: 1.5rem;">
                <div class="buttons" style="display: flex; gap: 10px;">
                    <a href="{{ url_for('editar_MTA_lista',id_equipo_info=id_equipo_info) }}" 
                       class="btn btn-primary">Ver MTA</a>
                    <a href="{{ url_for('mostrar_general_page', id_equipo_info=id_equipo_info, token=session['token']) }}" 
                       class="btn btn-secondary">Cerrar RCM</a>
                </div>                
            </div>
        </div>
        <div id="fade-container"></div>
        <div class="p-0">
            <div class="col p-3 pt-0">
                <button class="scroll-button left hidden" id="scroll-left">◀</button>
                <div class="scroll-container-horizontal">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Subsistema</th>
                                <th scope="col">Falla Funcional</th>
                                <th scope="col">Item o componente</th>
                                <th scope="col">Codigo Modo de Falla</th>
                                <th scope="col">Consecutivo de Modo de Falla</th>
                                <th scope="col">Descripción Modo de Falla</th>
                                <th scope="col">Causas</th>
                                <th scope="col">Hidden Failures</th>
                                <th scope="col">Safety</th>
                                <th scope="col">Environment</th>
                                <th scope="col">Operation</th>
                                <th scope="col">H1/S1/N1/O1</th>
                                <th scope="col">H2/S2/N2/O2</th>
                                <th scope="col">H3/S3/N3/O3</th>
                                <th scope="col">H4/S4/</th>
                                <th scope="col">H5</th>
                                <th scope="col">Tarea</th>
                                <th scope="col">Accion Recomendada</th>
                                <th scope="col">Intervalo Inicial</th>
                                <th colspan="3">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for rcm in rcms %}
                                <tr>
                                    <td>{{ loop.index }}</td>
                                    <td>{{ rcm['sistema'] }}</td>
                                    <td>{{ rcm['falla_funcional'] }}</td>
                                    <td>{{ rcm['componente'] }}</td>
                                    <td>{{ rcm['codigo_modo_falla'] }}</td>
                                    <td>{{ rcm['consecutivo_modo_falla'] }}</td>
                                    <td>{{ rcm['descripcion_modo_falla'] }}</td>
                                    <td>{{ rcm['causa'] }}</td>
                                    <td>{{ rcm['hidden_failures'] }}</td>
                                    <td>{{ rcm['safety'] }}</td>
                                    <td>{{ rcm['environment'] }}</td>
                                    <td>{{ rcm['operation'] }}</td>
                                    <td>{{ rcm['h1_s1_n1_o1'] }}</td>
                                    <td>{{ rcm['h2_s2_n2_o2'] }}</td>
                                    <td>{{ rcm['h3_s3_n3_o'] }}</td>
                                    <td>{{ rcm['h4_s4'] }}</td>
                                    <td>{{ rcm['h5'] }}</td>
                                    <td>{{ rcm['tarea'] }}</td>
                                    <td>{{ rcm['accion_recomendada'] }}</td>
                                    <td>{{ rcm['intervalo_inicial_horas'] }}</td>
                                    <td>
                                        <button class="btn btn-warning btn-editar-rcm " data-bs-toggle="tooltip" data-bs-placement="top"
                                                title="Editar RCM">
                                            <a href="{{ url_for('editar_RCM', fmea_id=rcm['id_fmea'],id_equipo_info=id_equipo_info) }}" class="btn-editar-rcm"> RCM<i class="bi bi-pencil FMEA-edit"></i></a>
                                        </button>
                                    </td>
                                    <td>
                                        <button class="btn btn-danger mta" data-bs-toggle="tooltip" data-bs-placement="top"
                                                title="Eliminar RCM">
                                            <a href="{{ url_for('eliminar_RCM', fmea_id=rcm['id_fmea'],id_rcm=rcm['id'],id_equipo_info=id_equipo_info) }}">RCM<i class="bi bi-trash FMEA-edit"></i></a>
                                        </button>
                                    </td>
                                    <td>
                                        {% if rcm['id'] in rcms_con_mta %}
                                            <button class="btn btn-warning btn-editar-mta" data-bs-toggle="tooltip" data-bs-placement="top"
                                                    title="Editar MTA">
                                                <a href="{{ url_for('editar_MTA', rcm_id=rcm['id'],id_equipo_info=id_equipo_info) }}"> MTA <i class="bi bi-pencil FMEA-edit"></i></a>
                                            </button>
                                        {% else %}
                                            <button class="btn btn-success btn-crear-mta" data-bs-toggle="tooltip" data-bs-placement="top"
                                                    title="Crear RCM">
                                                <a href="{{ url_for('registro_MTA',id_equipo_info=id_equipo_info, fmea_id=rcm['id_fmea']) }}"> MTA <i class="bi bi-plus-circle FMEA-edit"></i></a>
                                            </button>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <button class="scroll-button right" id="scroll-right">▶</button>
            </div>
        </div>
    </div>

    
<script src="{{ url_for('static', filename='js/editar_RCM.js') }}"></script>


<style>
    .scroll-container-horizontal {
        position: relative;
        overflow-x: auto;
        white-space: nowrap;
    }

    .scroll-button {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        z-index: 10;
        background-color: rgba(0, 0, 0, 0.6);
        color: white;
        border: none;
        padding: 10px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        position: fixed;
    }

    .scroll-button.left {
        left: 0;
    }

    .scroll-button.right {
        right: 0;
    }

    .scroll-button.hidden {
        display: none;
    }
</style>

<script>
    const scrollContainer = document.querySelector('.scroll-container-horizontal');
    const scrollLeftButton = document.getElementById('scroll-left');
    const scrollRightButton = document.getElementById('scroll-right');

    // Scroll amount
    const scrollAmount = 10; // Smaller increments for smooth continuous scroll
    let scrollInterval;

    // Update button visibility
    function updateButtonVisibility() {
        const scrollLeft = scrollContainer.scrollLeft;
        const maxScrollLeft = scrollContainer.scrollWidth - scrollContainer.clientWidth;

        scrollLeftButton.classList.toggle('hidden', scrollLeft === 0);
        scrollRightButton.classList.toggle('hidden', scrollLeft >= maxScrollLeft);
    }

    // Start scrolling
    function startScrolling(direction) {
        stopScrolling(); // Prevent multiple intervals
        scrollInterval = setInterval(() => {
            scrollContainer.scrollBy({ left: direction * scrollAmount });
        }, 10); // Continuous scroll every 10ms
    }

    // Stop scrolling
    function stopScrolling() {
        clearInterval(scrollInterval);
    }

    // Scroll left
    scrollLeftButton.addEventListener('mousedown', () => startScrolling(-1));
    scrollLeftButton.addEventListener('mouseup', stopScrolling);
    scrollLeftButton.addEventListener('mouseleave', stopScrolling);

    // Scroll right
    scrollRightButton.addEventListener('mousedown', () => startScrolling(1));
    scrollRightButton.addEventListener('mouseup', stopScrolling);
    scrollRightButton.addEventListener('mouseleave', stopScrolling);

    // Add scroll event listener
    scrollContainer.addEventListener('scroll', updateButtonVisibility);

    // Initial visibility update
    updateButtonVisibility();
</script>

{% endblock %}
