{% extends '/base.html' %}

{% block title %}Cotecmar || Equipo - Análisis funcional{% endblock %}

{% block custom %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/FMEA.css') }}">
{% endblock %}

{% block body %}
<div class="container" id="reporte" >
    <div class="row toolBar">
        <div class="col-8 m-0 pt-3" style="align-content: center;">
            <h3 class="titulo">Análisis Funcional</h3>
            <h5 style="color: #013882; padding-left: 10px; "> Para {{ nombre_equipo }} </h5>
        </div>
        <div class="col-4 pt-3" style="align-items: start; justify-content: end; display: flex; padding-right: 1.5rem;">
            <div class="buttons" style="display: flex; gap: 10px;">
                <a href="{{ url_for('registro_analisis_funcional', id_equipo_info=id_equipo_info) }}" 
                   class="btn btn-primary">Agregar análisis funcional</a>
                   <a href="{% if from_url %}{{ from_url }}{% if '?' in from_url %}&from=analisis_funcional{% else %}?from=analisis_funcional{% endif %}{% else %}{{ url_for('equipos_buque', nombre_buque=nombre_buque, from='analisis_funcional') }}{% endif %}" 
                    class="btn btn-secondary">
                    Terminar Análisis funcional
                    </a>
                           
            </div>                
        </div>
    </div>
    <div id="fade-container"></div>
    <div class="p-4">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th scope="col">Sistema</th>
                    <th scope="col">Subsistema</th>
                    <th scope="col">Verbo</th>
                    <th scope="col">Acción</th>
                    <th scope="col">Estándar de desempeño</th>
                    <th scope="col" colspan="2">Acciones</th>
                </tr>
            </thead>
            <tbody>
        
            {% for analisis in analisis_funcionales %}
                <tr style="cursor: pointer;" onclick="toggleComponentes({{ analisis.id }})">
                    <td>{{ sistema.nombre if sistema else 'No hay sistema seleccionado'}}</td>
                    <td>{{ analisis.subsistema_nombre }}</td>
                    <td>{{ analisis.verbo }}</td>
                    <td>{{ analisis.accion }}</td>
                    <td>{{ analisis.estandar_desempeño }}</td>
                    <td>
                        <a class="boton" href="{{ url_for('editar_analisis_funcional', id=analisis.id, id_equipo_info=id_equipo_info) }}" ><i class="bi bi-pen"></i></a>
                    </td>
                    <td>    
                        <button type="button" class="btn btn-danger btn-eliminar" data-id="{{ analisis.id }}">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>        
                </tr>
            {% endfor %}
            </tbody>
        </table>
        
        {% for analisis in analisis_funcionales %}
            <!-- Tabla de componentes para cada análisis funcional, inicialmente oculta -->
            <table id="componentes-{{ analisis.id }}" class="table componentes table-bordered" style="display: none;">
                <thead>
                    <tr>
                        <th colspan="3">{{ analisis.subsistema_nombre }}</th>
                    </tr>
                    <tr>
                        <th scope="col">Nombre</th>
                        <th scope="col">Verbo</th>
                        <th scope="col">Acción</th>
                    </tr>
                </thead>
                <tbody>
                    {% for componente in componentes %}
                        {% if componente.id_analisis_funcional == analisis.id %}
                        <tr>
                            <td>{{ componente.nombre }}</td>
                            <td>{{ componente.verbo }}</td>
                            <td>{{ componente.accion }}</td>
                        </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        {% endfor %}
    </div>
</div>

<script>
    function toggleComponentes(idAnalisis) {
        // Selecciona la tabla de componentes correspondiente
        var tablaComponentes = document.getElementById('componentes-' + idAnalisis);
        
        // Cambia la visibilidad
        if (tablaComponentes.style.display === 'none') {
            tablaComponentes.style.display = 'table';
        } else {
            tablaComponentes.style.display = 'none';
        }
    }
</script>
<script src="{{ url_for('static', filename='js/mostrar_analisis_funcional.js') }}"></script>


{% endblock %}
